                -webkit-print-color-adjust: exact;
                padding: 5px;
            }
            
            /* ุงูุดุจูุฉ ูู ุงูุทุจุงุนุฉ: ุนููุฏูู ูุงุณุชุบูุงู ุงููุณุงุญุฉ */
            .grid-form { 
                display: grid !important; 
                grid-template-columns: 1fr 1fr; /* ุนููุฏูู ูุชุณุงูููู */
                gap: 10px 20px; /* ุชุจุงุนุฏ ุจุณูุท */
            }

            /* ุงูุญูู ุงููุงุญุฏ */
            .form-group { 
                display: flex; 
                flex-direction: column;
                margin-bottom: 0;
            }

            .form-group label { 
                font-size: 9pt;
                font-weight: bold;
                color: #555;
                margin-bottom: 2px;
            }

            /* ุชุญููู ุงููุฏุฎูุงุช ุฅูู ูุตูุต ุนุงุฏูุฉ */
            .form-group input, .form-group select, .form-group textarea { 
                border: none !important;
                border-bottom: 1px dotted #999 !important; /* ุฎุท ูููุท ุฃุณูู ุงููุต */
                background: transparent !important;
                padding: 0 !important;
                font-weight: bold;
                color: #000;
                font-size: 11pt;
                height: auto;
                min-height: auto;
                resize: none;
                appearance: none; /* ุฅุฎูุงุก ุณูู ุงููุงุฆูุฉ ุงูููุณุฏูุฉ */
            }

            /* ุฅุฎูุงุก ุงูู placeholder ุนูุฏ ุงูุทุจุงุนุฉ */
            ::placeholder { color: transparent; }
            
            /* ุงูุชุฃูุฏ ูู ุธููุฑ ุงููุญุชูู */
            .tab-content { display: block !important; }
            #tab-db, #tab-settings { display: none !important; } /* ุถูุงู ุนุฏู ุธููุฑ ุงูุฌุฏุงูู ุฃู ุงูุฅุนุฏุงุฏุงุช */
            #tab-form { display: block !important; }
        }
    </style>
</head>
<body>

    <div id="notification"></div>

    <div id="login-screen">
        <div class="login-box">
            <h2>ุชุณุฌูู ุงูุฏุฎูู</h2>
            <p style="color: #666; font-size: 0.9rem;">ุฃุฏุฎู ุฑูุฒ ุงููุฑูุฑ ูููุชุงุจุนุฉ</p>
            <form onsubmit="handleLogin(event)">
                <input type="password" id="login-code" placeholder="ุฑูุฒ ุงูุฏุฎูู" required autocomplete="off">
                <button type="submit" class="btn btn-primary full-width">ุฏุฎูู</button>
            </form>
        </div>
    </div>

    <div id="app-interface" class="hidden">
        <header>
            <div id="app-title">ูุธุงู ุงูุณุฌูุงุช</div>
            <div style="display: flex; align-items: center; gap: 10px;">
                <span id="user-role-display" style="font-size: 0.8rem; background: rgba(255,255,255,0.2); padding: 4px 8px; border-radius: 4px;"></span>
                <button onclick="handleLogout()" class="btn btn-danger" style="padding: 5px 10px; font-size: 12px;">ุฎุฑูุฌ</button>
            </div>
        </header>

        <div class="container">
            <div class="tabs no-print">
                <button class="tab-btn admin-only" id="btn-tab-form" onclick="switchTab('tab-form')">ุฅุถุงูุฉ / ุชุนุฏูู</button>
                <button class="tab-btn" id="btn-tab-db" onclick="switchTab('tab-db')">ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุงูุจุญุซ</button>
                <button class="tab-btn admin-only" id="btn-tab-settings" onclick="switchTab('tab-settings')">ุงูุฅุนุฏุงุฏุงุช</button>
            </div>

            <div id="tab-form" class="tab-content hidden">
                <form id="main-form" onsubmit="handleSave(event)">
                    <input type="hidden" id="f_id"> 
                    
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;" class="no-print admin-only">
                        <button type="button" class="btn btn-outline" onclick="resetForm()">ูุณุญ ุงููููุฐุฌ (ุฌุฏูุฏ)</button>
                        <button type="submit" class="btn btn-primary" id="save-btn">ุญูุธ ุงูุณุฌู</button>
                    </div>

                    <div class="form-section">
                        <h3>1. ุงููุนูููุงุช ุงูุดุฎุตูุฉ</h3>
                        <div class="grid-form">
                            <div class="form-group"><label>ุงูุงุณู ุงูุฑุจุงุนู ูุงูููุจ</label><input type="text" id="f_name" required></div>
                            <div class="form-group"><label>ุชุงุฑูุฎ ุงููููุงุฏ</label><input type="date" id="f_dob"></div>
                            <div class="form-group"><label>ูุญู ุงูุชููุฏ</label><input type="text" id="f_pob"></div>
                            <div class="form-group"><label>ุงูุฌูุณ</label>
                                <select id="f_gender">
                                    <option value="ุฐูุฑ">ุฐูุฑ</option>
                                    <option value="ุฃูุซู">ุฃูุซู</option>
                                </select>
                            </div>
                            <div class="form-group"><label>ุงุณู ุงูุฃู ุงูุซูุงุซู</label><input type="text" id="f_mother"></div>
                            <div class="form-group"><label>ุฑูู ุงููููุฉ</label><input type="text" id="f_national_id"></div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>2. ุงูุญุงูุฉ ุงูุงุฌุชูุงุนูุฉ</h3>
                        <div class="grid-form">
                            <div class="form-group">
                                <label>ุงูุญุงูุฉ ุงูุฒูุฌูุฉ</label>
                                <select id="f_marital" onchange="toggleMaritalFields()">
                                    <option value="ุฃุนุฒุจ">ุฃุนุฒุจ</option>
                                    <option value="ูุชุฒูุฌ">ูุชุฒูุฌ</option>
                                    <option value="ูุทูู">ูุทูู</option>
                                    <option value="ุฃุฑูู">ุฃุฑูู</option>
                                </select>
                            </div>
                            <div class="form-group hidden" id="group-spouse"><label>ุงุณู ุงูุฒูุฌ/ุงูุฒูุฌุฉ</label><input type="text" id="f_spouse"></div>
                            <div class="form-group hidden" id="group-children"><label>ุนุฏุฏ ุงูุฃุทูุงู</label><input type="number" id="f_children"></div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>3. ุงูุชุนููู ูุงูุนูู</h3>
                        <div class="grid-form">
                            <div class="form-group"><label>ุงูุชุญุตูู ุงูุฏุฑุงุณู</label><input type="text" id="f_education"></div>
                            <div class="form-group"><label>ุงูุชุฎุตุต ุงูุฏุฑุงุณู</label><input type="text" id="f_specialization"></div>
                            <div class="form-group"><label>ุงูุนูู ุงูุญุงูู</label><input type="text" id="f_job"></div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>4. ุงูุณูู ูุงูุงุชุตุงู</h3>
                        <div class="grid-form">
                            <div class="form-group"><label>ุฑูู ุงููุงุชู</label><input type="tel" id="f_phone" required></div>
                            <div class="form-group"><label>ุงูุนููุงู (ุงููุญุงูุธุฉ/ุงููุถุงุก)</label><input type="text" id="f_address_1"></div>
                            <div class="form-group"><label>ุชูุงุตูู ุงูุนููุงู (ููุทูุฉ/ุฏุงุฑ)</label><input type="text" id="f_address_2"></div>
                            <div class="form-group"><label>ุฃูุฑุจ ููุทุฉ ุฏุงูุฉ</label><input type="text" id="f_landmark"></div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>5. ุงูุจูุงูุงุช ุงูุชูุธูููุฉ</h3>
                        <div class="grid-form">
                            <div class="form-group"><label>ุงูููุฆุฉ</label><input type="text" id="f_org_body"></div>
                            
                            <div class="form-group">
                                <label>ุงููุฑุน</label>
                                <select id="f_org_branch">
                                    <option value="">ุงุฎุชุฑ ุงููุฑุน...</option>
                                    <option value="ุงููุฑุน ุงูุฃูู">ุงููุฑุน ุงูุฃูู</option>
                                    <option value="ุงููุฑุน ุงูุซุงูู">ุงููุฑุน ุงูุซุงูู</option>
                                    <option value="ุงููุฑุน ุงูุซุงูุซ">ุงููุฑุน ุงูุซุงูุซ</option>
                                    <option value="ุงููุฑุน ุงูุฑุงุจุน">ุงููุฑุน ุงูุฑุงุจุน</option>
                                    <option value="ุงููุฑุน ุงูุฎุงูุณ">ุงููุฑุน ุงูุฎุงูุณ</option>
                                    <option value="ุงููุฑุน ุงูุณุงุฏุณ">ุงููุฑุน ุงูุณุงุฏุณ</option>
                                    <option value="ุฃุฎุฑู">ุฃุฎุฑู</option>
                                </select>
                            </div>

                            <div class="form-group"><label>ุงูุดุนุจุฉ</label><input type="text" id="f_org_div"></div>
                            <div class="form-group"><label>ุงุณู ุงูุดุนุจุฉ</label><input type="text" id="f_org_div_name"></div>
                            <div class="form-group"><label>ุงูุตูู</label><input type="text" id="f_org_class"></div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>6. ูุนูููุงุช ุฅุถุงููุฉ</h3>
                        <div class="grid-form">
                            <div class="form-group"><label>ุงูุฎุจุฑุงุช</label><textarea id="f_skills"></textarea></div>
                            <div class="form-group"><label>ุงููุนุฑู</label><input type="text" id="f_ref_name" placeholder="ุงูุงุณู ูุฑูู ุงููุงุชู"></div>
                            <div class="form-group"><label>ููุงุญุธุงุช</label><textarea id="f_notes"></textarea></div>
                        </div>
                    </div>
                </form>
            </div>

            <div id="tab-db" class="tab-content hidden">
                <div class="table-controls no-print">
                    <input type="text" id="search-input" placeholder="ุจุญุซ (ุงูุงุณูุ ุงููุงุชูุ ุงููููุฉ)..." onkeyup="renderTable()" style="flex: 2; min-width: 200px; padding: 10px; border: 1px solid var(--border); border-radius: 6px;">
                    
                    <select id="filter-branch" onchange="renderTable()" style="padding: 10px; border: 1px solid var(--border); border-radius: 6px;">
                        <option value="">ูู ุงููุฑูุน</option>
                        <option value="ุงููุฑุน ุงูุฃูู">ุงููุฑุน ุงูุฃูู</option>
                        <option value="ุงููุฑุน ุงูุซุงูู">ุงููุฑุน ุงูุซุงูู</option>
                        <option value="ุงููุฑุน ุงูุซุงูุซ">ุงููุฑุน ุงูุซุงูุซ</option>
                        <option value="ุงููุฑุน ุงูุฑุงุจุน">ุงููุฑุน ุงูุฑุงุจุน</option>
                        <option value="ุงููุฑุน ุงูุฎุงูุณ">ุงููุฑุน ุงูุฎุงูุณ</option>
                        <option value="ุงููุฑุน ุงูุณุงุฏุณ">ุงููุฑุน ุงูุณุงุฏุณ</option>
                        <option value="ุฃุฎุฑู">ุฃุฎุฑู</option>
                    </select>

                    <button onclick="window.print()" class="btn btn-outline">ุทุจุงุนุฉ ุงูุฌุฏูู</button>
                    <button onclick="exportToCSV()" class="btn btn-success admin-only">ุชุตุฏูุฑ Excel</button>
                </div>
                <div class="table-responsive">
                    <table id="records-table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>ุงูุงุณู</th>
                                <th>ุงููุฑุน</th> <th>ุงููุงุชู</th>
                                <th>ุงูุนูู</th>
                                <th class="no-print">ุฅุฌุฑุงุกุงุช</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
                <p id="records-count" style="margin-top: 10px; color: #666;"></p>
            </div>

            <div id="tab-settings" class="tab-content hidden admin-only">
                <div class="form-section">
                    <h3>ุชุฎุตูุต ุงููุธูุฑ</h3>
                    <div class="form-group"><label>ููู ุงููุธุงู</label><input type="color" id="set-color" onchange="saveSettings()" style="height: 40px; width: 100%;"></div>
                    <div class="form-group"><label>ุงูุนููุงู</label><input type="text" id="set-title" oninput="saveSettings()"></div>
                </div>

                <div class="form-section">
                    <h3>ุงููุณุฎ ุงูุงุญุชูุงุทู</h3>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="exportJSON()" class="btn btn-success">ุชุญููู ูุณุฎุฉ (Backup)</button>
                        <label class="btn btn-outline" style="cursor: pointer;">
                            ุงุณุชุนุงุฏุฉ ูุณุฎุฉ
                            <input type="file" accept=".json" onchange="importJSON(this)" style="display: none;">
                        </label>
                    </div>
                    <hr>
                    <button onclick="wipeData()" class="btn btn-danger">ุญุฐู ุฌููุน ุงูุจูุงูุงุช</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const DB_KEY = 'local_db_v2';
        let appData = {
            settings: { themeColor: '#2563eb', appTitle: 'ูุธุงู ุฅุฏุงุฑุฉ ุงูุจูุงูุงุช' },
            records: []
        };
        let currentRole = null; // 'ADMIN' or 'VIEWER'

        window.onload = function() {
            loadData();
            applySettings();
            
            // Check session role
            const savedRole = sessionStorage.getItem('app_role');
            if (savedRole) {
                currentRole = savedRole;
                showApp();
            } else {
                document.getElementById('login-screen').classList.remove('hidden');
            }
        };

        function loadData() {
            const stored = localStorage.getItem(DB_KEY);
            if (stored) {
                appData = JSON.parse(stored);
                if (!appData.records) appData.records = [];
                if (!appData.settings) appData.settings = {};
            }
        }

        function saveData() {
            localStorage.setItem(DB_KEY, JSON.stringify(appData));
        }

        function applySettings() {
            document.documentElement.style.setProperty('--primary', appData.settings.themeColor || '#2563eb');
            const title = appData.settings.appTitle || 'ูุธุงู ุฅุฏุงุฑุฉ ุงูุจูุงูุงุช';
            document.getElementById('app-title').textContent = title;
            document.title = title;
            document.getElementById('set-title').value = title;
            document.getElementById('set-color').value = appData.settings.themeColor;
        }

        // --- Auth Logic ---
        function handleLogin(e) {
            e.preventDefault();
            const code = document.getElementById('login-code').value;
            
            if (code === '110011') {
                currentRole = 'ADMIN';
                sessionStorage.setItem('app_role', 'ADMIN');
                showApp();
            } else if (code === '789') {
                currentRole = 'VIEWER';
                sessionStorage.setItem('app_role', 'VIEWER');
                showApp();
            } else {
                showNotify('ุฑูุฒ ุงูุฏุฎูู ุบูุฑ ุตุญูุญ', 'error');
            }
        }

        function handleLogout() {
            sessionStorage.removeItem('app_role');
            currentRole = null;
            location.reload();
        }

        function showApp() {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('app-interface').classList.remove('hidden');
            document.getElementById('user-role-display').textContent = currentRole === 'ADMIN' ? 'ุงููุฏูุฑ' : 'ุฒุงุฆุฑ';
            
            // UI Logic based on Role
            const adminElements = document.querySelectorAll('.admin-only');
            if (currentRole === 'VIEWER') {
                adminElements.forEach(el => el.classList.add('hidden'));
                switchTab('tab-db'); // Viewer starts at DB
            } else {
                adminElements.forEach(el => el.classList.remove('hidden'));
                switchTab('tab-form'); // Admin starts at Form
            }
            renderTable();
        }

        // --- Tabs ---
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.getElementById(tabId).classList.remove('hidden');
            
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            if(tabId === 'tab-form') document.getElementById('btn-tab-form').classList.add('active');
            if(tabId === 'tab-db') { document.getElementById('btn-tab-db').classList.add('active'); renderTable(); }
            if(tabId === 'tab-settings') document.getElementById('btn-tab-settings').classList.add('active');
        }

        // --- Form Handling ---
        function toggleMaritalFields() {
            const status = document.getElementById('f_marital').value;
            const isMarried = status === 'ูุชุฒูุฌ';
            const spouseGroup = document.getElementById('group-spouse');
            const childGroup = document.getElementById('group-children');

            if (isMarried) {
                spouseGroup.classList.remove('hidden');
                childGroup.classList.remove('hidden');
            } else {
                spouseGroup.classList.add('hidden');
                childGroup.classList.add('hidden');
                document.getElementById('f_spouse').value = '';
                document.getElementById('f_children').value = '';
            }
        }

        function resetForm() {
            if(currentRole !== 'ADMIN') return;
            document.getElementById('main-form').reset();
            document.getElementById('f_id').value = '';
            document.getElementById('save-btn').textContent = 'ุญูุธ ุงูุณุฌู';
            document.getElementById('save-btn').classList.remove('btn-success');
            document.getElementById('save-btn').classList.add('btn-primary');
            toggleMaritalFields();
        }

        function handleSave(e) {
            e.preventDefault();
            if(currentRole !== 'ADMIN') return;

            const idVal = document.getElementById('f_id').value;
            
            const record = {
                id: idVal ? parseInt(idVal) : Date.now(),
                name: document.getElementById('f_name').value,
                dob: document.getElementById('f_dob').value,
                pob: document.getElementById('f_pob').value,
                gender: document.getElementById('f_gender').value,
                mother: document.getElementById('f_mother').value,
                national_id: document.getElementById('f_national_id').value,
                marital: document.getElementById('f_marital').value,
                spouse: document.getElementById('f_spouse').value,
                children: document.getElementById('f_children').value,
                education: document.getElementById('f_education').value,
                specialization: document.getElementById('f_specialization').value,
                job: document.getElementById('f_job').value,
                phone: document.getElementById('f_phone').value,
                address_1: document.getElementById('f_address_1').value,
                address_2: document.getElementById('f_address_2').value,
                landmark: document.getElementById('f_landmark').value,
                org_body: document.getElementById('f_org_body').value,
                org_branch: document.getElementById('f_org_branch').value,
                org_div: document.getElementById('f_org_div').value,
                org_div_name: document.getElementById('f_org_div_name').value,
                org_class: document.getElementById('f_org_class').value,
                skills: document.getElementById('f_skills').value,
                ref_name: document.getElementById('f_ref_name').value,
                notes: document.getElementById('f_notes').value
            };

            if (idVal) {
                const index = appData.records.findIndex(r => r.id == idVal);
                if (index !== -1) { appData.records[index] = record; showNotify('ุชู ุงูุชุญุฏูุซ', 'success'); }
            } else {
                appData.records.push(record);
                showNotify('ุชู ุงูุญูุธ', 'success');
            }

            saveData();
            resetForm();
        }

        function editRecord(id) {
            if(currentRole !== 'ADMIN') return;
            const rec = appData.records.find(r => r.id == id);
            if (!rec) return;

            resetForm();
            switchTab('tab-form');

            document.getElementById('f_id').value = rec.id;
            document.getElementById('f_name').value = rec.name;
            document.getElementById('f_dob').value = rec.dob;
            document.getElementById('f_pob').value = rec.pob;
            document.getElementById('f_gender').value = rec.gender;
            document.getElementById('f_mother').value = rec.mother;
            document.getElementById('f_national_id').value = rec.national_id;
            document.getElementById('f_marital').value = rec.marital;
            toggleMaritalFields();
            document.getElementById('f_spouse').value = rec.spouse || '';
            document.getElementById('f_children').value = rec.children || '';
            document.getElementById('f_education').value = rec.education;
            document.getElementById('f_specialization').value = rec.specialization;
            document.getElementById('f_job').value = rec.job;
            document.getElementById('f_phone').value = rec.phone;
            document.getElementById('f_address_1').value = rec.address_1;
            document.getElementById('f_address_2').value = rec.address_2;
            document.getElementById('f_landmark').value = rec.landmark;
            document.getElementById('f_org_body').value = rec.org_body;
            document.getElementById('f_org_branch').value = rec.org_branch || '';
            document.getElementById('f_org_div').value = rec.org_div;
            document.getElementById('f_org_div_name').value = rec.org_div_name;
            document.getElementById('f_org_class').value = rec.org_class;
            document.getElementById('f_skills').value = rec.skills;
            document.getElementById('f_ref_name').value = rec.ref_name || '';
            document.getElementById('f_notes').value = rec.notes;

            const btn = document.getElementById('save-btn');
            btn.textContent = 'ุชุญุฏูุซ ุงูุจูุงูุงุช';
            btn.classList.replace('btn-primary', 'btn-success');
        }

        function deleteRecord(id) {
            if(currentRole !== 'ADMIN') return;
            if (confirm('ุญุฐู ุงูุณุฌูุ')) {
                appData.records = appData.records.filter(r => r.id != id);
                saveData();
                renderTable();
                showNotify('ุชู ุงูุญุฐู', 'error');
            }
        }

        // --- Database & Print ---
        function renderTable() {
            const tbody = document.querySelector('#records-table tbody');
            tbody.innerHTML = '';
            
            const search = document.getElementById('search-input').value.toLowerCase();
            const filterBranch = document.getElementById('filter-branch').value; 

            const filtered = appData.records.filter(r => {
                const txt = `${r.name} ${r.phone} ${r.national_id}`.toLowerCase();
                const matchSearch = txt.includes(search);
                const matchBranch = filterBranch ? (r.org_branch === filterBranch) : true;
                return matchSearch && matchBranch;
            });

            document.getElementById('records-count').textContent = `ุงูุนุฏุฏ: ${filtered.length}`;

            filtered.forEach((r, idx) => {
                const tr = document.createElement('tr');
                
                // Admin Actions vs Viewer Actions
                let actionsHTML = `<button onclick="printRecord(${r.id})" class="btn btn-outline" style="padding:5px;">๐จ๏ธ ุทุจุงุนุฉ</button>`;
                
                if (currentRole === 'ADMIN') {
                    actionsHTML += `
                        <button onclick="editRecord(${r.id})" class="btn btn-primary" style="padding:5px;">โ๏ธ</button>
                        <button onclick="deleteRecord(${r.id})" class="btn btn-danger" style="padding:5px;">๐๏ธ</button>
                    `;
                }

                tr.innerHTML = `
                    <td>${idx + 1}</td>
                    <td><strong>${r.name}</strong></td>
                    <td>${r.org_branch || '-'}</td>
                    <td dir="ltr">${r.phone}</td>
                    <td>${r.job || '-'}</td>
                    <td class="no-print">${actionsHTML}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function printRecord(id) {
            const rec = appData.records.find(d => d.id == id);
            if (!rec) return;

            // Populate form fields manually
            document.getElementById('f_name').value = rec.name;
            document.getElementById('f_dob').value = rec.dob;
            document.getElementById('f_pob').value = rec.pob;
            document.getElementById('f_gender').value = rec.gender;
            document.getElementById('f_mother').value = rec.mother;
            document.getElementById('f_national_id').value = rec.national_id;
            document.getElementById('f_marital').value = rec.marital;
            toggleMaritalFields();
            document.getElementById('f_spouse').value = rec.spouse || '';
            document.getElementById('f_children').value = rec.children || '';
            document.getElementById('f_education').value = rec.education;
            document.getElementById('f_specialization').value = rec.specialization;
            document.getElementById('f_job').value = rec.job;
            document.getElementById('f_phone').value = rec.phone;
            document.getElementById('f_address_1').value = rec.address_1;
            document.getElementById('f_address_2').value = rec.address_2;
            document.getElementById('f_landmark').value = rec.landmark;
            document.getElementById('f_org_body').value = rec.org_body;
            document.getElementById('f_org_branch').value = rec.org_branch || '';
            document.getElementById('f_org_div').value = rec.org_div;
            document.getElementById('f_org_div_name').value = rec.org_div_name;
            document.getElementById('f_org_class').value = rec.org_class;
            document.getElementById('f_skills').value = rec.skills;
            document.getElementById('f_ref_name').value = rec.ref_name || '';
            document.getElementById('f_notes').value = rec.notes;

            // Switch to form tab temporarily for printing
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.getElementById('tab-form').classList.remove('hidden');
            
            setTimeout(() => {
                window.print();
                // Restore view
                if(currentRole === 'VIEWER') switchTab('tab-db');
                else switchTab('tab-db'); 
            }, 300);
        }

        // --- Export/Import (Admin Only) ---
        function exportJSON() {
            if(currentRole !== 'ADMIN') return;
            const str = JSON.stringify(appData, null, 2);
            const blob = new Blob([str], { type: 'application/json' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `backup_${new Date().toISOString().slice(0,10)}.json`;
            a.click();
        }

        function importJSON(input) {
            if(currentRole !== 'ADMIN') return;
            const file = input.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    appData = JSON.parse(e.target.result);
                    saveData();
                    loadData();
                    showNotify('ุชู ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ', 'success');
                } catch (err) { alert('ููู ุบูุฑ ุตุงูุญ'); }
            };
            reader.readAsText(file);
        }

        function exportToCSV() {
            if(currentRole !== 'ADMIN') return;
            let csv = "\uFEFFุงูุงุณู,ุงููุฑุน,ุงููุงุชู,ุงูุชููุฏ,ุงูุนูู,ุงูุนููุงู\n";
            appData.records.forEach(r => {
                csv += `"${r.name}","${r.org_branch}","${r.phone}","${r.dob}","${r.job}","${r.address_1}"\n`;
            });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(new Blob([csv], { type: 'text/csv;charset=utf-8;' }));
            link.download = "data.csv";
            link.click();
        }

        function wipeData() {
            if(currentRole !== 'ADMIN') return;
            if (confirm('ุณูุชู ุญุฐู ูู ุงูุจูุงูุงุช! ูู ุฃูุช ูุชุฃูุฏุ')) {
                localStorage.removeItem(DB_KEY);
                location.reload();
            }
        }

        function saveSettings() {
            if(currentRole !== 'ADMIN') return;
            appData.settings.themeColor = document.getElementById('set-color').value;
            appData.settings.appTitle = document.getElementById('set-title').value;
            saveData();
            applySettings();
        }

        function showNotify(msg, type) {
            const n = document.getElementById('notification');
            n.textContent = msg;
            n.className = type === 'success' ? 'notify-success' : 'notify-error';
            n.style.opacity = '1';
            n.style.bottom = '20px';
            setTimeout(() => { n.style.opacity = '0'; n.style.bottom = '-50px'; }, 3000);
        }
    </script>
</body>
</html>
